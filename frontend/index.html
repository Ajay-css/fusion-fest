<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fusion Fest ‚Äì Event Booking Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== RESET & BASE ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Outfit",sans-serif}
body{background:radial-gradient(circle at top,#0a0016 0%,#000 80%);color:#fff;overflow-x:hidden;}
h1,h2,h3{font-family:"Orbitron",sans-serif;letter-spacing:1px}
a{text-decoration:none;color:inherit}

/* ===== NAVBAR ===== */
nav{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  z-index:10;
  background:rgba(15,15,30,0.9);
  backdrop-filter:blur(10px);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:1rem 2rem;
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.nav-left .logo{
  font-family:"Orbitron",sans-serif;
  font-weight:700;
  font-size:1.4rem;
  color:#a855f7;
}

.nav-right{
  display:flex;
  align-items:center;
  gap:1rem;
}

.nav-links{
  display:flex;
  gap:1rem;
}

.nav-links button{
  background:none;
  border:none;
  color:#fff;
  font-weight:600;
  font-size:1rem;
  cursor:pointer;
  position:relative;
  transition:color .3s ease;
}

.nav-links button::after{
  content:"";
  position:absolute;
  bottom:-4px;
  left:50%;
  width:0;
  height:2px;
  background:#a855f7;
  transition:all .3s ease;
  transform:translateX(-50%);
}

.nav-links button:hover, .nav-links button.active{color:#a855f7}
.nav-links button:hover::after, .nav-links button.active::after{width:100%}

.nav-toggle{
  display:none;
  font-size:1.6rem;
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
}

/* ===== HEADER ===== */
header{text-align:center;padding:7rem 1rem 3rem;}
header h1{font-size:2.5rem;color:#a855f7;text-shadow:0 0 15px #a855f7;}
header p{color:#ccc;font-size:1.1rem}

/* ===== SECTION WRAPPER ===== */
main{max-width:1200px;margin:auto;padding:1rem;}
section{display:none;margin-bottom:3rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:2rem;box-shadow:0 0 20px rgba(168,85,247,0.15);animation:fadeIn .6s ease forwards;}
.home-h2{margin-bottom:20px;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

/* ===== CARDS GRID ===== */
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:2.5rem;}
.card{background:rgba(255,255,255,0.05);border:1px solid rgba(168,85,247,0.4);display:flex;flex-direction:column;gap:5px;border-radius:16px;padding:1rem;transition:transform .4s ease,box-shadow .4s ease;}
.card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 0 25px #a855f7;}
.card img{width:100%;border-radius:12px;height:160px;object-fit:cover;margin-bottom:.8rem;}
button.glow{border:none;background:linear-gradient(90deg,#a855f7,#3b82f6);color:#fff;padding:.6rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;}
button.glow:hover{box-shadow:0 0 15px #a855f7;transform:translateY(-2px);}

/* ===== FORMS ===== */
form{max-width:420px;margin:auto}
input,textarea{width:100%;padding:.7rem;margin:.4rem 0;border-radius:8px;border:none;background:rgba(255,255,255,0.1);color:#fff;transition:all .3s ease;}
input::placeholder,textarea::placeholder{color:#aaa}
input:focus,textarea:focus{background:rgba(255,255,255,0.2);outline:none;box-shadow:0 0 10px #a855f7;}
form button{width:100%;margin-top:1rem}
.message{text-align:center;margin-top:1rem;color:#4ade80;font-weight:500;display:none}

/* ===== TOASTS ===== */
#toastContainer{position:fixed;top:25px;right:25px;z-index:9999;display:flex;flex-direction:column;gap:10px;align-items:flex-end;}
.toast{min-width:250px;background:rgba(17,17,17,0.9);border-left:5px solid #a855f7;color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 0 15px rgba(168,85,247,0.3);display:flex;align-items:center;justify-content:space-between;animation:slideIn .4s ease, fadeOut .4s ease 4s forwards;font-size:.95rem;}
.toast.success{border-color:#22c55e;}
.toast.error{border-color:#ef4444;}
.toast.warning{border-color:#f59e0b;}
.toast button{background:none;border:none;color:#aaa;font-size:1rem;cursor:pointer;}
@keyframes slideIn{from{opacity:0;transform:translateY(-30px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeOut{to{opacity:0;transform:translateX(100%);}}

/* ===== MOBILE RESPONSIVE ===== */
@media(max-width:768px){
  header h1{font-size:2rem}
  .nav-links{
    position:fixed;
    top:0; right:-100%;
    height:100vh;
    width:220px;
    flex-direction:column;
    background:rgba(15,15,30,0.95);
    padding-top:4rem;
    gap:1.5rem;
    transition:right .3s ease;
    z-index:999;
  }
  .nav-links.show{right:0;}
  .nav-toggle{display:block;}
}
</style>
</head>
<body>

<nav>
  <div class="nav-left">
    <span class="logo">Fusion Fest</span>
  </div>
  <div class="nav-right">
    <button class="nav-toggle" onclick="toggleMenu()">‚ò∞</button>
    <div class="nav-links">
      <button onclick="showSection('home')">Home</button>
      <button onclick="showSection('login')">Login</button>
      <button onclick="showSection('register')">Register</button>
      <button onclick="showSection('vendorLogin')">Vendor Login</button>
      <button onclick="showSection('vendorRegister')">Vendor Register</button>
      <button onclick="showSection('cart')">Cart</button>
      <button id="logoutBtn" style="display:none" onclick="logout()">Logout</button>
    </div>
  </div>
</nav>

<header>
  <h1>Fusion Fest</h1>
  <p>Your all-in-one event booking destination</p>
</header>

<main>
  <!-- HOME -->
  <section id="home" style="display:block">
    <h2 class="home-h2">‚ú® Featured Events</h2>
    <div class="card-grid" id="featuredEvents">
      <div class="card"><img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e"><h3>Wedding Photography</h3><p>Capture your special moments with professional flair.</p></div>
      <div class="card"><img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836"><h3>Catering Services</h3><p>Delicious multi-cuisine menus for any occasion.</p></div>
      <div class="card"><img src="https://images.unsplash.com/photo-1484154218962-a197022b5858"><h3>Stage Decor & Lighting</h3><p>Transform any venue into a breathtaking space.</p></div>
      <div class="card"><img src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30"><h3>DJ & Live Music</h3><p>Groove to beats that keep your guests dancing all night.</p></div>
    </div>

    <h2 style="margin-top:3rem; margin-bottom: 20px;">üéâ Available Vendors</h2>
    <div>
      <input type="text" id="searchInput" placeholder="Search vendors by name, category, city..." style="margin-bottom:1rem;padding:.6rem;width:100%;border-radius:8px;border:none;">
    </div>
    <div class="card-grid" id="vendorList"></div>
  </section>

  <!-- CUSTOMER LOGIN -->
  <section id="login">
    <h2>üîê Customer Login</h2>
    <form id="loginForm">
      <input name="username" placeholder="Username or Email" required>
      <input type="password" name="password" placeholder="Password" required>
      <button class="glow" type="submit">Login</button>
    </form>
  </section>

  <!-- CUSTOMER REGISTER -->
  <section id="register">
    <h2>üìù Customer Register</h2>
    <form id="registerForm">
      <input name="firstName" placeholder="First Name" required>
      <input name="lastName" placeholder="Last Name" required>
      <input name="username" placeholder="Username" required>
      <input type="email" name="email" placeholder="Email" required>
      <input name="phone" placeholder="Phone" required>
      <input type="password" name="password" placeholder="Password" required>
      <button class="glow" type="submit">Register</button>
    </form>
  </section>

  <!-- VENDOR LOGIN -->
  <section id="vendorLogin">
    <h2>üîë Vendor Login</h2>
    <form id="vendorLoginForm">
      <input name="username" placeholder="Username or Email" required>
      <input type="password" name="password" placeholder="Password" required>
      <button class="glow" type="submit">Login</button>
    </form>
  </section>

  <!-- VENDOR REGISTER -->
  <section id="vendorRegister">
    <h2>üìù Vendor Register</h2>
    <form id="vendorRegisterForm">
      <input name="name" placeholder="Vendor Name" required>
      <input name="username" placeholder="Username" required>
      <input type="email" name="email" placeholder="Email" required>
      <input name="phone" placeholder="Phone" required>
      <input name="category" placeholder="Category" required>
      <input name="city" placeholder="City" required>
      <input name="area" placeholder="Area" required>
      <input name="description" placeholder="Short Description" required>
      <input type="number" name="price" placeholder="Base Price" required>
      <input name="image" placeholder="Image URL" required>
      <input type="password" name="password" placeholder="Password" required>
      <button class="glow" type="submit">Register</button>
    </form>
  </section>

  <!-- CART -->
  <section id="cart">
    <h2>üõí Your Cart</h2>
    <div id="cartItems"></div>
    <p id="cartTotal" style="margin-top:1rem;font-weight:bold;"></p>
    <button class="glow" onclick="checkoutCart()">Checkout</button>
  </section>
</main>

<div id="toastContainer"></div>

<script>
  const BASE_URL="https://fusion-fest-server-1.onrender.com/api";
let cart = [];  // cart array

function showToast(msg,type="success"){
  const c=document.getElementById("toastContainer");
  const t=document.createElement("div");
  t.className=`toast ${type}`;
  t.innerHTML=`<span>${msg}</span><button onclick="this.parentElement.remove()">√ó</button>`;
  c.appendChild(t);
  setTimeout(()=>t.remove(),4000);
}

/* NAVIGATION */
function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll(".nav-links button").forEach(b=>b.classList.remove("active"));
  document.querySelectorAll(".nav-links button").forEach(b=>{
    if(b.textContent.toLowerCase().includes(id)) b.classList.add("active");
  });
  if(id==="home") loadVendors();
  if(id==="cart") renderCart();
  if(document.querySelector(".nav-links.show")) document.querySelector(".nav-links").classList.remove("show"); // close mobile menu
}

// Hamburger toggle menu
function toggleMenu(){
  document.querySelector(".nav-links").classList.toggle("show");
}

// Hide mobile menu on link click
document.querySelectorAll(".nav-links button").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const navLinks = document.querySelector(".nav-links");
    if(navLinks.classList.contains("show")) navLinks.classList.remove("show");
  });
});

/* NAVBAR LOGIN/LOGOUT LOGIC */
function updateNavbar(){
  const customer = JSON.parse(localStorage.getItem("customer"));
  const vendor = JSON.parse(localStorage.getItem("vendor"));

  const loginBtn = document.querySelector(".nav-links button:nth-child(2)");
  const registerBtn = document.querySelector(".nav-links button:nth-child(3)");
  const vendorLoginBtn = document.querySelector(".nav-links button:nth-child(4)");
  const vendorRegisterBtn = document.querySelector(".nav-links button:nth-child(5)");
  const logoutBtn = document.getElementById("logoutBtn");

  if(customer || vendor){
    loginBtn.style.display = "none";
    registerBtn.style.display = "none";
    vendorLoginBtn.style.display = "none";
    vendorRegisterBtn.style.display = "none";
    logoutBtn.style.display = "inline";
  } else {
    loginBtn.style.display = "inline";
    registerBtn.style.display = "inline";
    vendorLoginBtn.style.display = "inline";
    vendorRegisterBtn.style.display = "inline";
    logoutBtn.style.display = "none";
  }
}

/* LOAD VENDORS */
let allVendors = [];
async function loadVendors(){
  const vendorList=document.getElementById("vendorList");
  vendorList.innerHTML="<p>Loading vendors...</p>";
  try{
    const res=await fetch(`${BASE_URL}/vendors`);
    if(!res.ok) throw new Error("Failed to fetch vendors");
    allVendors=await res.json();
    renderVendors(allVendors);
  }catch(err){console.error(err);vendorList.innerHTML="<p>Error loading vendors.</p>";}
}

function renderVendors(vendors){
  const vendorList=document.getElementById("vendorList");
  if(!vendors.length){vendorList.innerHTML="<p>No vendors found.</p>";return;}
  vendorList.innerHTML=vendors.map(v=>`
    <div class="card">
      <img src="${v.image||'https://via.placeholder.com/300x160'}" alt="${v.name}">
      <h3>${v.name}</h3>
      <p>${v.category}</p>
      <p>${v.city}, ${v.area}</p>
      <p>${v.description}</p>
      <p><strong>‚Çπ${v.price||0}</strong></p>
      <button class="glow" onclick="addToCart(${Date.now()},'${v.name}',${v.price||0})">Add to Cart</button>
    </div>`).join("");
}

/* SEARCH FILTER */
document.getElementById("searchInput").addEventListener("input",e=>{
  const q=e.target.value.toLowerCase();
  renderVendors(allVendors.filter(v=>v.name.toLowerCase().includes(q)||v.category.toLowerCase().includes(q)||v.city.toLowerCase().includes(q)));
});

/* CUSTOMER REGISTER/LOGIN */
document.getElementById("registerForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(e.target).entries());
  try{
    const res=await fetch(`${BASE_URL}/customers/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    if(!res.ok) throw new Error("Registration failed");
    showToast("‚úÖ Registration successful! Please login.","success");
    e.target.reset();setTimeout(()=>showSection("login"),1200);
  }catch(err){showToast("‚ùå Registration failed. Try again.","error");}
});

document.getElementById("loginForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(e.target).entries());
  try{
    const res=await fetch(`${BASE_URL}/customers/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    if(!res.ok) throw new Error("Invalid credentials");
    const user=await res.json();
    localStorage.setItem("customer",JSON.stringify(user));
    showToast(`Welcome ${user.firstName||user.username}!`,"success");
    updateNavbar();
    setTimeout(()=>showSection("home"),1000);
  }catch(err){showToast("‚ùå Login failed. Check credentials!","error");}
});

/* VENDOR REGISTER/LOGIN */
document.getElementById("vendorRegisterForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(e.target).entries());
  try{
    const res=await fetch(`${BASE_URL}/vendors/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    if(!res.ok) throw new Error("Vendor registration failed");
    showToast("‚úÖ Vendor registered successfully! Login now.","success");
    e.target.reset();setTimeout(()=>showSection("vendorLogin"),1200);
  }catch(err){showToast("‚ùå Vendor registration failed.","error");}
});

document.getElementById("vendorLoginForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const data=Object.fromEntries(new FormData(e.target).entries());
  try{
    const res=await fetch(`${BASE_URL}/vendors/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
    if(!res.ok) throw new Error("Invalid vendor credentials");
    const vendor=await res.json();
    localStorage.setItem("vendor",JSON.stringify(vendor));
    showToast(`Welcome Vendor ${vendor.name}!`,"success");
    updateNavbar();
    setTimeout(()=>showSection("home"),1000);
  }catch(err){showToast("‚ùå Vendor login failed.","error");}
});

/* LOGOUT */
function logout(){
  localStorage.removeItem("customer");
  localStorage.removeItem("vendor");
  showToast("Logged out successfully","warning");
  updateNavbar();
  showSection("home");
}

/* CART FUNCTIONS */
function addToCart(id,name,price){cart.push({id,name,price}); showToast(`‚úÖ ${name} added to cart`,"success"); renderCart();}
function renderCart(){
  const container=document.getElementById("cartItems");
  if(!cart.length){container.innerHTML="<p>No items in cart</p>";document.getElementById("cartTotal").textContent="";return;}
  container.innerHTML=cart.map((i,idx)=>`<div>${idx+1}. ${i.name} - ‚Çπ${i.price} <button onclick="removeFromCart(${idx})">Remove</button></div>`).join("");
  document.getElementById("cartTotal").textContent=`Total: ‚Çπ${cart.reduce((sum,i)=>sum+i.price,0)}`;
}
function removeFromCart(idx){cart.splice(idx,1);renderCart();}
async function checkoutCart(){
  const customer = JSON.parse(localStorage.getItem("customer"));
  if(!customer){showToast("Please login as customer to checkout!","warning"); showSection("login"); return;}
  if(cart.length===0){showToast("Cart is empty!","warning"); return;}
  const bookingData={bookingId:`BKG${Date.now()}`, customer:customer.username||"unknown", customerName:`${customer.firstName||""} ${customer.lastName||""}`.trim()||"Guest", customerEmail:customer.email||"unknown@example.com", customerPhone:customer.phone||"0000000000", items:cart.map(i=>({name:i.name,price:i.price,id:i.id})), total:cart.reduce((sum,i)=>sum+i.price,0), status:"pending"};
  try{
    const res=await fetch(`${BASE_URL}/bookings`,{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(bookingData)});
    if(!res.ok){const errData=await res.json(); throw new Error(errData.message||"Booking failed");}
    const savedBooking=await res.json();
    showToast(`‚úÖ Booking confirmed! Booking ID: ${savedBooking.bookingId}`, "success");
    cart=[]; renderCart();
  }catch(err){console.error("Booking error:",err); showToast(`‚ùå Booking failed: ${err.message}`,"error");}
}

/* INIT */
updateNavbar();
showSection("home");

</script>

</body>
</html>
