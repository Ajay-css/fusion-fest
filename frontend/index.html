<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fusion Fest ‚Äì Event Booking Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Outfit",sans-serif}
body{background:radial-gradient(circle at top,#0a0016 0%,#000 80%);color:#fff;overflow-x:hidden;}
h1,h2,h3{font-family:"Orbitron",sans-serif;letter-spacing:1px}
nav{position:fixed;top:0;left:0;width:100%;z-index:10;background:rgba(15,15,30,0.9);backdrop-filter:blur(10px);display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;border-bottom:1px solid rgba(255,255,255,0.1);}
.nav-left .logo{font-family:"Orbitron",sans-serif;font-weight:700;font-size:1.4rem;color:#a855f7;}
.nav-right{display:flex;align-items:center;gap:1rem;}
.nav-links{display:flex;gap:1rem;}
.nav-links button{background:none;border:none;color:#fff;font-weight:600;font-size:1rem;cursor:pointer;position:relative;transition:color .3s ease;}
.nav-links button::after{content:"";position:absolute;bottom:-4px;left:50%;width:0;height:2px;background:#a855f7;transition:all .3s ease;transform:translateX(-50%);}
.nav-links button:hover,.nav-links button.active{color:#a855f7}
.nav-links button:hover::after,.nav-links button.active::after{width:100%}
.nav-toggle{display:none;font-size:1.6rem;background:none;border:none;color:#fff;cursor:pointer;}
header{text-align:center;padding:7rem 1rem 3rem;}
header h1{font-size:2.5rem;color:#a855f7;text-shadow:0 0 15px #a855f7;}
header p{color:#ccc;font-size:1.1rem;}
main{max-width:1200px;margin:auto;padding:1rem;}
section{display:none;margin-bottom:3rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;padding:2rem;box-shadow:0 0 20px rgba(168,85,247,0.15);animation:fadeIn .6s ease forwards;}
.home-h2{margin-bottom:20px;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:2.5rem;}
.card{background:rgba(255,255,255,0.05);border:1px solid rgba(168,85,247,0.4);display:flex;flex-direction:column;gap:5px;border-radius:16px;padding:1rem;transition:transform .4s ease,box-shadow .4s ease;cursor:pointer;}
.card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 0 25px #a855f7;}
.card img{width:100%;border-radius:12px;height:160px;object-fit:cover;margin-bottom:.8rem;}
button.glow{border:none;background:linear-gradient(90deg,#a855f7,#3b82f6);color:#fff;padding:.6rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s ease;}
button.glow:hover{box-shadow:0 0 15px #a855f7;transform:translateY(-2px);}
form{max-width:420px;margin:auto}
input,textarea{width:100%;padding:.7rem;margin:.4rem 0;border-radius:8px;border:none;background:rgba(255,255,255,0.1);color:#fff;transition:all .3s ease;}
input::placeholder,textarea::placeholder{color:#aaa}
input:focus,textarea:focus{background:rgba(255,255,255,0.2);outline:none;box-shadow:0 0 10px #a855f7;}
form button{width:100%;margin-top:1rem}
#toastContainer{position:fixed;top:25px;right:25px;z-index:9999;display:flex;flex-direction:column;gap:10px;align-items:flex-end;}
.toast{min-width:250px;background:rgba(17,17,17,0.9);border-left:5px solid #a855f7;color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 0 15px rgba(168,85,247,0.3);display:flex;align-items:center;justify-content:space-between;animation:slideIn .4s ease, fadeOut .4s ease 4s forwards;font-size:.95rem;}
.toast.success{border-color:#22c55e;}
.toast.error{border-color:#ef4444;}
.toast.warning{border-color:#f59e0b;}
.toast button{background:none;border:none;color:#aaa;font-size:1rem;cursor:pointer;}
@keyframes slideIn{from{opacity:0;transform:translateY(-30px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeOut{to{opacity:0;transform:translateX(100%);}}
@media(max-width:768px){
  header h1{font-size:2rem}
  .nav-links{position:fixed;top:0; right:-100%;height:100vh;width:220px;flex-direction:column;background:rgba(15,15,30,0.95);padding-top:4rem;gap:1.5rem;transition:right .3s ease;z-index:999;}
  .nav-links.show{right:0;}
  .nav-toggle{display:block;}
}
</style>
</head>
<body>

<nav>
  <div class="nav-left"><span class="logo">Fusion Fest</span></div>
  <div class="nav-right">
    <button class="nav-toggle" onclick="toggleMenu()">‚ò∞</button>
    <div class="nav-links">
      <button onclick="showSection('home')">Home</button>
      <button onclick="showSection('cart')">Cart</button>
      <button onclick="showSection('myBookings')">My Bookings</button>
      <button id="loginBtn" onclick="showSection('login')">Login</button>
      <button id="vendorLoginBtn" onclick="showSection('vendorLogin')">Vendor Login</button>
      <button id="logoutBtn" style="display:none" onclick="logout()">Logout</button>
    </div>
  </div>
</nav>

<header>
  <h1>Fusion Fest</h1>
  <p>Your all-in-one event booking destination</p>
</header>

<main>
  <section id="home" style="display:block">
    <h2 class="home-h2">‚ú® Featured Vendors</h2>
    <div class="card-grid" id="featuredEvents"></div>
  </section>

  <section id="cart">
    <h2>üõí Your Cart</h2>
    <div id="cartItems"></div>
    <p id="cartTotal" style="margin-top:1rem;font-weight:bold;"></p>
    <button class="glow" onclick="checkoutCart()">Checkout</button>
  </section>

  <section id="payment">
    <h2>üí≥ Payment Gateway</h2>
    <form id="paymentForm">
      <input type="text" placeholder="Card Number" required>
      <input type="text" placeholder="Card Holder Name" required>
      <input type="text" placeholder="Expiry MM/YY" required>
      <input type="text" placeholder="CVV" required>
      <button class="glow" type="submit">Pay & Book</button>
    </form>
  </section>

  <section id="myBookings">
    <h2>üìÑ My Bookings</h2>
    <div id="bookingsList"></div>
  </section>

  <section id="login">
    <h2>üë§ Customer Login / Register</h2>
    <form id="loginForm">
      <input type="text" placeholder="Username" id="loginUsername" required>
      <input type="password" placeholder="Password" id="loginPassword" required>
      <button class="glow" type="submit">Login / Register</button>
    </form>
  </section>

  <section id="vendorLogin">
    <h2>üè¢ Vendor Login / Register</h2>
    <form id="vendorLoginForm">
      <input type="text" placeholder="Vendor Username" id="vendorUsername" required>
      <input type="password" placeholder="Password" id="vendorPassword" required>
      <button class="glow" type="submit">Login / Register</button>
    </form>
  </section>
</main>

<div id="toastContainer"></div>

<script>
const BASE_URL="http://localhost:5000/api";
let cart=[], allBookings=[], allVendors=[];

/* ===== TOAST ===== */
function showToast(msg,type="success"){
  const c=document.getElementById("toastContainer");
  const t=document.createElement("div");
  t.className=`toast ${type}`;
  t.innerHTML=`<span>${msg}</span><button onclick="this.parentElement.remove()">√ó</button>`;
  c.appendChild(t); setTimeout(()=>t.remove(),4000);
}

/* ===== NAV ===== */
function showSection(id){
  document.querySelectorAll("section").forEach(s => s?.style && (s.style.display="none"));
  const sec = document.getElementById(id);
  if(sec) sec.style.display="block";
  if(id==="cart") renderCart();
  if(id==="myBookings") renderBookings();
}
function toggleMenu(){document.querySelector(".nav-links").classList.toggle("show");}
function updateNavbar(){
  const customer=JSON.parse(localStorage.getItem("customer")||"null");
  const vendor=JSON.parse(localStorage.getItem("vendor")||"null");
  document.getElementById("logoutBtn").style.display = (customer||vendor) ? "inline" : "none";
  document.getElementById("loginBtn").style.display = customer||vendor ? "none" : "inline";
  document.getElementById("vendorLoginBtn").style.display = customer||vendor ? "none" : "inline";
}
function logout(){
  localStorage.removeItem("customer");
  localStorage.removeItem("vendor");
  showToast("Logged out!","success");
  updateNavbar();
  showSection("home");
}

/* ===== CART ===== */
function addToCart(name,price){cart.push({name,price}); showToast("Added to cart","success"); renderCart();}
function renderCart(){
  const c=document.getElementById("cartItems");
  if(!cart.length){c.innerHTML="<p>No items in cart</p>";document.getElementById("cartTotal").textContent=""; return;}
  c.innerHTML=cart.map((i,idx)=>`<div>${idx+1}. ${i.name} - ‚Çπ${i.price} <button onclick="removeFromCart(${idx})">Remove</button></div>`).join("");
  document.getElementById("cartTotal").textContent=`Total: ‚Çπ${cart.reduce((s,i)=>s+i.price,0)}`;
}
function removeFromCart(idx){cart.splice(idx,1); renderCart();}
function checkoutCart(){
  const customer=JSON.parse(localStorage.getItem("customer")||"null");
  if(!customer){showToast("Please login to checkout!","warning"); return;}
  if(!cart.length){showToast("Cart is empty!","warning"); return;}
  showSection("payment");
}

/* ===== PAYMENT ===== */
document.getElementById("paymentForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const customer=JSON.parse(localStorage.getItem("customer")||"null");
  if(!customer || !cart.length){showToast("Cart empty or login required!","warning"); return;}
  const bookingData={customer:customer.username,items:cart,total:cart.reduce((s,i)=>s+i.price,0),status:"Confirmed",date:new Date()};
  try{
    const res=await fetch(`${BASE_URL}/bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(bookingData)});
    const data=await res.json();
    if(!res.ok) throw new Error(data.message||"Booking failed");
    cart=[]; renderCart(); showToast("Booking confirmed!","success"); renderBookings(); showSection("myBookings");
  }catch(err){console.error(err); showToast(err.message,"error");}
});

/* ===== BOOKINGS ===== */
async function fetchBookings(){
  const customer=JSON.parse(localStorage.getItem("customer")||"null"); 
  if(!customer) return [];
  try{
    const res = await fetch(`${BASE_URL}/bookings/customer/${customer.username}`);
    if(!res.ok) throw new Error("Failed to fetch bookings");
    allBookings = await res.json();
    return allBookings;
  }catch(err){console.error(err); showToast("Failed to fetch bookings","error"); return []; }
}
async function renderBookings(){
  await fetchBookings();
  const c=document.getElementById("bookingsList");
  if(!allBookings.length){c.innerHTML="<p>No bookings yet</p>"; return;}
  c.innerHTML = allBookings.map((b,idx)=>`
    <div style="margin-bottom:1rem;padding:0.5rem;border:1px solid #a855f7;border-radius:8px;">
      <strong>${idx+1}. Booking ID: ${b._id}</strong><br>
      Items: ${b.items.map(it=>it.name).join(", ")}<br>
      Total: ‚Çπ${b.total} | Status: ${b.status}<br>
      <button class="glow" onclick="deleteBooking('${b._id}')">Delete</button>
      <button class="glow" onclick="downloadPDF(${idx})">Download PDF</button>
    </div>
  `).join("");
}
async function deleteBooking(id){
  if(!confirm("Are you sure you want to delete this booking?")) return;
  try{
    const res=await fetch(`${BASE_URL}/bookings/${id}`,{method:"DELETE"});
    if(!res.ok) throw new Error("Failed to delete booking");
    showToast("Booking deleted","success"); renderBookings();
  }catch(err){console.error(err); showToast(err.message,"error");}
}
function downloadPDF(idx){
  const b=allBookings[idx];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16); doc.text("Fusion Fest Booking Details",20,20);
  doc.setFontSize(12);
  doc.text(`Booking ID: ${b._id}`,20,30);
  doc.text(`Customer: ${b.customer}`,20,40);
  doc.text(`Status: ${b.status}`,20,50);
  doc.text(`Total: ‚Çπ${b.total}`,20,60);
  doc.text("Items:",20,70);
  b.items.forEach((it,i)=> doc.text(`${i+1}. ${it.name} - ‚Çπ${it.price}`,25,80+i*10));
  doc.save(`Booking_${b._id}.pdf`);
}

/* ===== VENDORS ===== */
async function fetchVendors(){
  try{
    const res = await fetch(`${BASE_URL}/vendors`);
    if(!res.ok) throw new Error("Failed to fetch vendors");
    allVendors = await res.json(); renderVendors();
  }catch(err){console.error(err); showToast("Failed to load vendors","error");}
}
function renderVendors(){
  const container=document.getElementById("featuredEvents");
  container.innerHTML = allVendors.map(v=>`
    <div class="card">
      <img src="${v.image || 'https://via.placeholder.com/300x160'}" alt="${v.name}">
      <h3>${v.name}</h3>
      <p>${v.description}</p>
      <button class="glow" onclick="addToCart('${v.name}',${v.price})">Book ‚Çπ${v.price}</button>
    </div>
  `).join("");
}

/* ===== LOGIN / REGISTER ===== */
async function loginOrRegister(endpoint, username, password, storageKey){
  try{
    let res = await fetch(`${BASE_URL}/${endpoint}/login`,{
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({username,password})
    });
    if(res.ok){ const data=await res.json(); localStorage.setItem(storageKey, JSON.stringify(data)); showToast("Logged in","success"); updateNavbar(); showSection("home"); return; }
    // if login fails, register
    res = await fetch(`${BASE_URL}/${endpoint}/register`,{
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({username,password})
    });
    if(res.ok){ const data=await res.json(); localStorage.setItem(storageKey, JSON.stringify(data)); showToast("Registered & logged in","success"); updateNavbar(); showSection("home"); }
    else{ const err = await res.json(); showToast(err.message || "Auth failed","error"); }
  }catch(err){console.error(err); showToast("Auth error","error");}
}
document.getElementById("loginForm").addEventListener("submit", e=>{
  e.preventDefault();
  const username=document.getElementById("loginUsername").value;
  const password=document.getElementById("loginPassword").value;
  if(username && password) loginOrRegister("customers", username, password, "customer");
});
document.getElementById("vendorLoginForm").addEventListener("submit", e=>{
  e.preventDefault();
  const username=document.getElementById("vendorUsername").value;
  const password=document.getElementById("vendorPassword").value;
  if(username && password) loginOrRegister("vendors", username, password, "vendor");
});

/* ===== INIT ===== */
updateNavbar();
fetchVendors();
showSection("home");
</script>

</body>
</html>